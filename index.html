<!DOCTYPE html>
<meta charset="utf-8">
<style>
    /* --Exchange lines-- */
    .dashed-line {
        stroke-width: 3;
        stroke: #B10000;
        stroke-linejoin: round;
        stroke-dasharray: 4;
        stroke-opacity: 1;
        animation: dash 1s linear infinite;
    }

    @keyframes dash {
        to {
            stroke-dashoffset: 0;
        }
    }

    /* --Countries-- */
    .subunit.DNK {
        fill: #34847d;
        position: absolute;
    }
    .subunit.DNB {
        fill: #34847d;
        position: absolute;
    }
    .subunit.SWE {
        fill: #e9eeee;
        position: absolute;
    }
    .subunit.DEU {
        fill: #e9eeee;
        position: absolute;
    }

    /* --Cities/Features-- */
    .place-label {
        fill: #000;
        fill-opacity: 1;
        font-size: 20px;
        font-weight: 300;
        text-anchor: middle;
        position: absolute;
    }
    text {
        -webkit-user-select:none;
        -khtml-user-select:none;
        -moz-user-select:none;
        -ms-user-select:none;
        -o-user-select:none;
        user-select:none;
        position: absolute;
    }

    /* --Textbox-- */
    .textbox.rect {
        fill: #e9eeee;
        opacity: 0.7;
        stroke: white;
        stroke-width: 2.5px ;
    }
    .textbox.text {
        fill: #34847d;
        font-family: "Trebuchet MS";
        font-size: 14px;
        font-weight: bolder;
    }

    /* --Windmill-- */
    .windmill_rotor {
        transform-origin: 50% 50%;
        transition: 60s;
        -webkit-animation: rotate 3s linear infinite;
        animation: rotate 3s linear infinite;
    }
    @-webkit-keyframes rotate {
        100% {
            -webkit-transform: rotate(360deg);
        }
    }
    @keyframes rotate {
        100% {
            transform: rotate(360deg);
        }
    }
    .windmill_pole {
        width: 4px;
        fill: white;
        stroke: black;
        stroke-width: 2px;
        height: 40px;
    }


</style>

<body>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>

    <script src="//d3js.org/topojson.v1.min.js"></script>

    <script>
        /*  --------- CREATION OF SVG  --------- */
        // SVG Height and Width
        var width = 1100,
            height = 600;

        // d3 is used to create SVG
        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

        // Choose projection and rotate/scale world
        var projection = d3.geo.albers()
            .center([24.8, 52.95])
            .rotate([0, 0, -10])
            .parallels([50, 60])
            .scale(10200)
            .translate([width / 2, height / 2]);

        /* --------- CREATE PATH ---------*/
        var path = d3.geo.path()
            .projection(projection);

        // Layering of elements due to d3 not supporting z-index layering
        var layer1 = svg.append('svg');
        var layer2 = svg.append('svg');
        var layer3 = svg.append('svg');
        var layer4 = svg.append('svg');


        /*  --------- COORDINATES FOR THE SVG --------- */
        var coords = {
            thorup_strand:[9.092772,57.1380563],
            kristiansand:[7.8691287,58.1529008],
            asaa:[10.417415,57.147015],
            goeteborg:[11.6136556,57.7006826],
            odense:[10.379272,55.399767],
            jyderup:[11.410810, 55.657214],
            rens:[9.150874, 54.874238],
            rendsburg:[9.5900401,54.2969277],
            helsingoer: [12.4695691,56.0344453],
            helsingborg:[12.5912339,56.0349086],
            ringsted:[11.789062, 55.456724],
            rostock: [12.0068693,54.1474698],
            hasle: [14.6718209,55.2079184],
            borrby: [14.1621923,55.456073],
            anholt_windmill_park: [11.174104, 56.597480]
        };


        /*  --------- CREATION OF ANIMATED DASHED LINES --------- */
        // Start-End coordinates of dashed lines (LONG,LATI) corresponding to (E,N)
        function dashed_line(start_coord,stop_coord,id){
            this.ccc = [start_coord, stop_coord];
            this.id = id;
        };

        var dashed_lines = [
            new dashed_line(coords.thorup_strand,coords.kristiansand,"jylland-norge" ),
            new dashed_line(coords.asaa,coords.goeteborg,"jylland_sverige" ),
            new dashed_line(coords.rens,coords.rendsburg,"jylland_tyskland" ),
            new dashed_line(coords.helsingoer,coords.helsingborg,"sjaelland_sverige" ),
            new dashed_line(coords.ringsted,coords.rostock,"sjaelland_tyskland"),
            new dashed_line(coords.odense,coords.jyderup,"storebaelt"),
            new dashed_line(coords.hasle,coords.borrby,"bornholm_sverige")
        ];

        // Dashed lines are appended to Layer2 (in front of layer1 (background) )
        // Dashed lines are classed as dashed-lines."linename" in CSS
        layer3.selectAll(".dashed-line")
            .data(dashed_lines)
            .enter().append("path")
            .datum( function(d){
                return {
                    type: "LineString", coordinates: d.ccc// points in decimal degrees
                };
            })
            .attr("d", path)
            .attr("class", "dashed-line " + function(d){return d.id})
            .attr("stroke-dashoffset", 48 );


        /* ----- CREATE TEXT ELEMENTS ----- */
        function textbox(coord,coord_offset_x,coord_offset_y,width,height,id,text){
            this.upper_right_coordinates = [coord[0]+coord_offset_x, coord[1]+coord_offset_y ];
            this.width = width;
            this.height = height;
            this.x = projection(this.upper_right_coordinates)[0]-this.width;
            this.y = projection(this.upper_right_coordinates)[1];
            this.id = id;
            this.text = text;
            this.text_offset = 12;
            this.text_x = this.x+this.text_offset;
            this.text_y = this.y+2*this.text_offset;
        };

        var textboxes = [
            new textbox(coords.thorup_strand,-0.15,0.1,140,65,"jylland-norge","JYLLAND - NORGE"),
            new textbox(coords.asaa,1.7,0.05,150,50,"jylland-sverige","JYLLAND - SVERIGE"),
            new textbox(coords.rens,-0.15,0.1,150,50,"jylland-tyskland","JYLLAND - TYSKLAND"),
            new textbox(coords.helsingoer,1.7,0.2,150,50,"jylland-tyskland","JYLLAND - TYSKLAND"),
            new textbox(coords.ringsted,1.7,-0.5,150,50,"jylland-tyskland","JYLLAND - TYSKLAND"),
            new textbox(coords.odense,0.8,-0.1,150,50,"jylland-tyskland","JYLLAND - TYSKLAND"),
            new textbox(coords.hasle,-0.15,0.1,150,50,"jylland-tyskland","JYLLAND - TYSKLAND"),
        ];

        layer3.selectAll(".textbox.text")
            .data(textboxes)
            .enter().append("text")
            .text(function(d){return d.text})
            .attr('x', function(d){return d.text_x})
            .attr('y', function(d){return d.text_y})
            .attr("class", "textbox text "+function(d){return d.id});

        layer2.selectAll(".textbox.rect")
            .data(textboxes)
            .enter().append("rect")
            .attr('width', function(d){return d.width})
            .attr('height', function(d){return d.height})
            .attr('x', function(d){return d.x})
            .attr('y', function(d){return d.y})
            .attr("class", "textbox rect "+function(d){return d.id});


        /* ----- ANIMATED WINDMILLS ----- */
        rotor_height = 75;
        rotor_width = 75;
        pole_height = 40;
        pole_width = 6;
        windmill_height_offset = 20;
        windmill_width_offset = 20;
        layer3.append("image")
            .attr("height",rotor_height)
            .attr("x",projection(coords.anholt_windmill_park)[0]-Math.round(rotor_width/2))
            .attr("y",projection(coords.anholt_windmill_park)[1]-2*pole_height)
            .attr("xlink:href","img/windmill_rotor.png")
            .attr("class","windmill_rotor");
        layer4.append("image")
            .attr("height",rotor_height)
            .attr("x",projection(coords.anholt_windmill_park)[0]-Math.round(rotor_width/2)-windmill_width_offset)
            .attr("y",projection(coords.anholt_windmill_park)[1]-2*pole_height-windmill_height_offset)
            .attr("xlink:href","img/windmill_rotor.png")
            .attr("class","windmill_rotor");
        layer2.append("rect")
            .attr("x",projection(coords.anholt_windmill_park)[0]-Math.round(pole_width/2))
            .attr("y",projection(coords.anholt_windmill_park)[1]-pole_height)
            .attr("class","windmill_pole");
        layer2.append("rect")
            .attr("x",projection(coords.anholt_windmill_park)[0]-Math.round(pole_width/2)-windmill_width_offset)
            .attr("y",projection(coords.anholt_windmill_park)[1]-pole_height-windmill_height_offset)
            .attr("class","windmill_pole");

        /* --------- CREATE MAP --------- */
        // Get JSON file and create the world on layer1 (Background)
        d3.json("dk_ger_swe.json", function(error, topo) {

            // VARIABLES
            var subunits = topojson.feature(topo, topo.objects.subunits);
            var subunits_features = topojson.feature(topo, topo.objects.subunits).features;
            var places = topojson.feature(topo, topo.objects.places);
            var places_features = topojson.feature(topo, topo.objects.places).features;


            // GET ALL SUBUNITS FROM SHAPEFILE AND APPEND TO PATH
            layer1.selectAll(".subunit")
                .data(subunits_features)
                .enter().append("path")
                .attr("class", function(d) { return "subunit " + d.id; })
                .attr("d", path);

            // GET PLACES (CITIES) FROM PLACES SHAPEFILE
            layer1.append("path")
                .datum(places)
                .attr("d", path)
                .attr("class", "place");
        });

    </script>
</body>